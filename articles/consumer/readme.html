<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Getting started with the PnP Core SDK | PnP Core SDK </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Getting started with the PnP Core SDK | PnP Core SDK ">
    <meta name="generator" content="docfx 2.51.0.0">
    
    <link rel="shortcut icon" href="../../https://c.s-microsoft.com/favicon.ico?v2">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    <meta property="docfx:rel" content="../../">
    <meta property="docfx:newtab" content="true">
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="getting-started-with-the-pnp-core-sdk">Getting started with the PnP Core SDK</h1>

<p>The PnP Core SDK is designed to be used in modern .Net development, hence it relies on dependency injection (<a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/host/generic-host?view=aspnetcore-3.1">generic host</a>) for it's core services. This implies that before you can actually use the PnP Core SDK you need to configure the needed services. Once that's done you can obtain a <code>PnPContext</code> from the <code>PnPContextFactory</code> and start using the library.</p>
<h2 id="where-is-the-code">Where is the code?</h2>
<p>The PnP Core SDK is maintained in the PnP GitHub repository: <a href="https://github.com/pnp/pnpcore">https://github.com/pnp/pnpcore</a>. You'll find:</p>
<ul>
<li>The code of the PnP Core SDK in the <code>src\sdk</code> folder</li>
<li>Examples of how to use the PnP Core SDK in the <code>src\samples</code> folder</li>
<li>The source of the documentation you are reading right now in the <code>docs</code> folder</li>
</ul>
<h2 id="referencing-the-pnp-core-sdk-in-your-project">Referencing the PnP Core SDK in your project</h2>
<p>At this point the PnP Core SDK has not yet been published as a nuget package, so you'll need to reference the SDK as DLL in your solution. You can build the <code>PnP.Core</code> solution and reference the DLL from the projects build output (e.g. <code>src\sdk\PnP.Core\bin\Debug\netstandard2.1\PnP.Core.dll</code>) or alternatively include the PnP Core project (<code>src\PnP.Core\PnP.Core.csproj</code>) in your project as a dependency. The latter approach does make it really easy for you to debug PnP Core when you're writing code.</p>
<h2 id="configuring-the-needed-services">Configuring the needed services</h2>
<p>Below snippet shows how to configure the needed services in a .Net Core console app: it's required to add and configure the <code>AuthenticationProviderFactory</code> and the <code>PnPContextFactory</code> services. Typically you would also include configuration and logging as well.</p>
<pre><code class="lang-csharp">var host = Host.CreateDefaultBuilder()
// Set environment to use
.UseEnvironment(&quot;demo&quot;) // you can eventually read it from environment variables
// Configure logging
.ConfigureServices((hostingContext, services) =&gt;
{
    var customSettings = new CustomSettings();
    hostingContext.Configuration.Bind(&quot;CustomSettings&quot;, customSettings);

    services
    // Setup PnP authentication providers
    .AddAuthenticationProviderFactory(options =&gt;
    {
        // CredentialManager provider
        options.Configurations.Add(new OAuthCredentialManagerConfiguration
        {
            Name = &quot;CredentialManagerAuthentication&quot;,
            CredentialManagerName = customSettings.CredentialManager,
            // You can optionally provide a custom ClientId, or the SDK will use a default one
            ClientId = customSettings.ClientId,
        });
        // Username + Pwd provider
        options.Configurations.Add(new OAuthUsernamePasswordConfiguration
        {
            Name = &quot;UsernameAndPasswordAuthentication&quot;,
            Username = customSettings.UserPrincipalName,
            Password = customSettings.Password.ToSecureString(),
            // You can optionally provide a custom ClientId, or the SDK will use a default one
            ClientId = customSettings.ClientId,
        });
        // Set default provider
        options.DefaultConfiguration = &quot;CredentialManagerAuthentication&quot;;
    })
    // Setup the PnP context factory
    .AddPnPContextFactory(options =&gt;
    {
        options.Configurations.Add(new PnPContextFactoryOptionsConfiguration
        {
            Name = &quot;SiteToWorkWith&quot;,
            SiteUrl = new Uri(customSettings.TargetSiteUrl),
            AuthenticationProviderName = &quot;CredentialManagerAuthentication&quot;,
        });
    });
})
// Let the builder know we're running in a console
.UseConsoleLifetime()
// Add services to the container
.Build();
</code></pre>
<p>In above sample the following configuration file is used: <code>appsettings.demo.json</code></p>
<pre><code class="lang-json">{
  &quot;CustomSettings&quot;: {
    &quot;TargetSiteUrl&quot;: &quot;https://contoso.sharepoint.com/sites/pnp&quot;,
    &quot;CredentialManager&quot;: &quot;mycreds&quot;,
    &quot;UserPrincipalName&quot;: &quot;joe@contoso.onmicrosoft.com&quot;,
    &quot;Password&quot;: &quot;password&quot;,
  },
  &quot;Logging&quot;: {
    &quot;LogLevel&quot;: {
      &quot;Default&quot;: &quot;Information&quot;
    }
  }
}
</code></pre>
<div class="NOTE">
<h5>Note</h5>
<p>To learn more about how to setup authentication check the <a href="configuring%20authentication.html">Configuring authentication</a> article.</p>
</div>
<h2 id="obtaining-a-pnpcontext">Obtaining a PnPContext</h2>
<p>The <code>PnPContext</code> is the entry point for using the PnP Core SDK, you can create a <code>PnPContext</code> from either a SharePoint site url or the id of a Microsoft 365 group.</p>
<pre><code class="lang-csharp">// Start console host
await host.StartAsync();

using (var scope = host.Services.CreateScope())
{
    // Obtain a PnP Context factory
    var pnpContextFactory = scope.ServiceProvider.GetRequiredService&lt;IPnPContextFactory&gt;();
    // Use the PnP Context factory to get a PnPContext for the given configuration
    using (var context = pnpContextFactory.Create(&quot;SiteToWorkWith&quot;))
    {
        // See next chapter on how to use the PnPContext
    }

    using (var context = pnpContextFactory.Create(&quot;Microsoft 365 Group guid&quot;))
    {
        // See next chapter on how to use the PnPContext
    }
}

// Cleanup console host
host.Dispose();
</code></pre>
<p>Next to creating a new <code>PnPContext</code> you can also clone an existing one, cloning is very convenient if you for example created a context for the root web of your site collection but now want to work with a sub site. Below snippet shows how to use cloning:</p>
<pre><code class="lang-csharp">using (var context = pnpContextFactory.Create(&quot;SiteToWorkWith&quot;))
{
    var web = await context.Web.GetAsync();
    Console.WriteLine($&quot;Title: {web.Title}&quot;);

    using (var subSiteContext = context.Clone(new Uri(&quot;https://contoso.sharepoint.com/sites/siteA/subsite&quot;)))
    {
        var subWeb = await subSiteContext.Web.GetAsync();
        Console.WriteLine($&quot;Sub site title: {subWeb.Title}&quot;);
    }
}
</code></pre>
<h2 id="using-the-pnpcontext-for-operations-on-microsoft-365">Using the PnPContext for operations on Microsoft 365</h2>
<p>All operations on Microsoft 365 start from the <code>PnPContext</code> instance you've obtained from the <code>PnPContextFactory</code>. Below sample shows a simple get operation that requests data from Microsoft 365 and outputs it to the console:</p>
<pre><code class="lang-csharp">using (var context = pnpContextFactory.Create(&quot;SiteToWorkWith&quot;))
{
    var web = await context.Web.GetAsync();
    Console.WriteLine($&quot;Title: {web.Title}&quot;);
}
</code></pre>
<p>Here follows another example that shows how to define which properties need to be loaded while executing the request:</p>
<pre><code class="lang-csharp">var team = await context.Team.GetAsync(p =&gt; p.Description, p =&gt; p.FunSettings, p =&gt; p.DiscoverySettings, p =&gt; p.Members);
</code></pre>
<p>When you see an asynchronous call being used, it means that the call is executed immediately.
However, you can easily group multiple requests in a batch and send them in one call to the server via the built in batching support:</p>
<pre><code class="lang-csharp">var web = await context.Web.GetAsync();
var myList = web.Lists.GetByTitle(&quot;TestList&quot;);
if (myList != null)
{
    // Create three list items and add them via single server request
    Dictionary&lt;string, object&gt; values = new Dictionary&lt;string, object&gt;
    {
        { &quot;Title&quot;, &quot;PnP Rocks!&quot; }
    };

    myList.Items.Add(values);
    myList.Items.Add(values);
    myList.Items.Add(values);

    // Send batch to the server
    await context.ExecuteAsync();
}
</code></pre>
<p>To update Microsoft 365 you simply update the needed properties in your model and then call <code>UpdateAsync</code> or <code>Update</code> (used for batching):</p>
<pre><code class="lang-csharp">var web = await context.Web.GetAsync(p =&gt; p.Lists);
var myList = web.Lists.GetByTitle(&quot;Documents&quot;);

if (myList != null)
{
    myList.Description = $&quot;Updated on UTC {DateTime.UtcNow}&quot;;
    await myList.UpdateAsync();
}
</code></pre>
<p>Deleting follows a similar pattern, but now you use <code>DeleteAsync</code> or <code>Delete</code>:</p>
<pre><code class="lang-csharp">var web = await context.Web.GetAsync(p =&gt; p.Lists);
var myList = web.Lists.GetByTitle(&quot;ListToDelete&quot;);

if (myList != null)
{
    await myList.DeleteAsync();
}
</code></pre>
<p>If you like, you can also leverage a fluent syntax enriched with LINQ (Language Integrated Query). For example, in the following code excerpt you can see how to write a query for the items of a list.</p>
<pre><code class="lang-csharp">var document = context.Web.Lists.GetByTitle(&quot;Documents&quot;).Items
                            .Where(i =&gt; i.Title == &quot;Sample Document&quot;)
                            .Load(i =&gt; i.Id, i =&gt; i.Title)
                            .FirstOrDefault();

if (document != null) 
{
    Console.WriteLine($&quot;Document Title: {document.Title}&quot;);
}
</code></pre>
<p>Another approach to mainly limit the data that's being pulled from Microsoft 365 is using the <code>Include()</code> lambda expression, below example shows using <code>Include()</code> in a recursive manner: next to the Title property of the Web this request also loads the Lists for the Web and for each List it loads the Id, Title, DocumentTemplate and ContentTypes property. Given List ContentTypes is a collection the Name and FieldLinks properties are loaded and for FieldLinks the Name property is loaded.</p>
<pre><code class="lang-csharp">await context.Web.GetAsync(p =&gt; p.Title,
                           p =&gt; p.ContentTypes.Include(p =&gt; p.Name),
                           p =&gt; p.Lists.Include(p =&gt; p.Id, p =&gt; p.Title, p =&gt; p.DocumentTemplate,
                               p =&gt; p.ContentTypes.Include(p =&gt; p.Name,
                                    p =&gt; p.FieldLinks.Include(p =&gt; p.Name)))
                          );
</code></pre>
</article>
          </div>
          <div class="contribution-panel mobile-hide">
              <a href="https://github.com/pnp/pnpcore/blob/dev/docs/articles/consumer/readme.md/#L1" title="Improve this Doc" class="fab btn-warning pull-right"><i class="glyphicon glyphicon-pencil"></i></a>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              </nav>
            </div>
          </div>        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            PnP Core SDK
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
